<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Using External Libraries and Interfaces" href="coding_in_other.html" /><link rel="prev" title="Coding in Python for Sage" href="coding_in_python.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>Coding in Cython - Developer Guide</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="_static/custom-furo.css?v=d2ecc25a" />
    <link rel="stylesheet" type="text/css" href="_static/custom-jupyter-sphinx.css?v=75860c6b" />
    <link rel="stylesheet" type="text/css" href="_static/custom-codemirror-monokai.css?v=b5588f12" />
    <link rel="stylesheet" type="text/css" href="_static/custom-tabs.css?v=8a724d73" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  --color-brand-primary: #0f0fff;
  --color-brand-content: #0f0fff;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">Developer Guide</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><div class="sidebar-scroll"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="_static/logo_sagemath_black.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="_static/logo_sagemath_white.svg" alt="Dark Logo"/>
  </div>
  
      <span class="sidebar-brand-text">passagemath 10.6.1 Documentation</span>
  
</a><div class="select-wrapper">
  <select id="versions-menu" onchange="changeVersion()">
    <option value="" selected>other version</option>
    <option value="https://doc-develop--sagemath.netlify.app">develop</option>
  </select>
</div><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-home">
  <div class="sidebar-tree">
    <ul><li class="toctree-l1">
      <a class="reference internal" href="index.html">Home - Developer Guide</a>
    </li></ul>
  </div>
</div><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="walkthrough.html">Development Walk-through</a></li>
<li class="toctree-l1"><a class="reference internal" href="git_setup.html">Setting Up Git</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="github.html">The passagemath Repository on GitHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflows.html">Using Git with GitHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="review.html">Reviewing Code</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="git_basic.html">Git Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="git_advanced.html">Advanced Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="git_background.html">Git Tips and References</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="workspace.html">Setting up Your Workspace</a></li>
<li class="toctree-l1"><a class="reference internal" href="coding_basics.html">General Conventions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="doctesting.html">Running Sage’s Doctests</a></li>
<li class="toctree-l1"><a class="reference internal" href="portability_testing.html">Testing on Multiple Platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">Development and Testing Tools</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="sage_manuals.html">The Sage Manuals</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="coding_in_python.html">Coding in Python for Sage</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Coding in Cython</a></li>
<li class="toctree-l1"><a class="reference internal" href="coding_in_other.html">Using External Libraries and Interfaces</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="packaging.html">Packaging Third-Party Code for Sage</a></li>
<li class="toctree-l1"><a class="reference internal" href="downstream.html">Packaging the Sage Library for Monolithic Distribution (ignore)</a></li>
<li class="toctree-l1"><a class="reference internal" href="packaging_sage_library.html">Packaging the Sage Library for Modularized Distribution in passagemath</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="https://github.com/passagemath/passagemath/blob/develop/src/doc/en/developer/coding_in_cython.rst" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div><div class="edit-this-page">
  <a class="muted-link" href="https://github.com/passagemath/passagemath/edit/develop/src/doc/en/developer/coding_in_cython.rst" title="Edit this page">
    <svg><use href="#svg-pencil"></use></svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="coding-in-cython">
<span id="chapter-cython"></span><h1>Coding in Cython<a class="headerlink" href="#coding-in-cython" title="Link to this heading">¶</a></h1>
<p>This chapter discusses Cython, which is a compiled language based on
Python.  The major advantage it has over Python is that code can be
much faster (sometimes orders of magnitude) and can directly call
C and C++ code.  As Cython is essentially a superset of the Python
language, one often doesn’t make a distinction between Cython and
Python code in Sage (e.g. one talks of the “Sage Python Library”
and “Python Coding Conventions”).</p>
<p>Python is an interpreted language and has no declared data types for
variables. These features make it easy to write and debug, but Python
code can sometimes be slow. Cython code can look a lot like Python,
but it gets translated into C code (often very efficient C code) and
then compiled. Thus it offers a language which is familiar to Python
developers, but with the potential for much greater speed. Cython also
allows Sage developers to interface with C and C++ much easier than
using the Python C API directly.</p>
<p>Cython is a compiled version of Python. It was originally based on
Pyrex but has changed based on what Sage’s developers needed; Cython
has been developed in concert with Sage. However, it is an independent
project now, which is used beyond the scope of Sage. As such, it is a
young, but developing language, with young, but developing
documentation. See its web page, <a class="reference external" href="http://www.cython.org/">http://www.cython.org/</a>, for the most
up-to-date information or check out the
<a class="reference external" href="http://docs.cython.org/src/userguide/language_basics.html">Language Basics</a>
to get started immediately.</p>
<section id="writing-cython-code-in-sage">
<h2>Writing Cython code in Sage<a class="headerlink" href="#writing-cython-code-in-sage" title="Link to this heading">¶</a></h2>
<p>There are several ways to create and build Cython code in Sage.</p>
<ol class="arabic">
<li><p>In the Sage notebook or the Sage command line, begin any cell with
a line containing <code class="docutils literal notranslate"><span class="pre">%%cython</span></code>. When you evaluate that cell,</p>
<ol class="arabic">
<li><p>It is saved to a file.</p></li>
<li><p>Cython is run on it with all the standard Sage libraries
automatically linked if necessary.</p></li>
<li><p>The resulting shared library file (<code class="docutils literal notranslate"><span class="pre">.so</span></code> / <code class="docutils literal notranslate"><span class="pre">.dll</span></code> /
<code class="docutils literal notranslate"><span class="pre">.dylib</span></code>) is then loaded into your running instance of Sage.</p></li>
<li><p>The functionality defined in that cell is now available for you
to use in the notebook. Also, the output cell has a link to the C
program that was compiled to create the <code class="docutils literal notranslate"><span class="pre">.so</span></code> file.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">cpdef</span></code> or <code class="docutils literal notranslate"><span class="pre">def</span></code> function, say <code class="docutils literal notranslate"><span class="pre">testfunction</span></code>, defined in
a <code class="docutils literal notranslate"><span class="pre">%%cython</span></code> cell in a worksheet can be imported and made available
in a different <code class="docutils literal notranslate"><span class="pre">%%cython</span></code> cell within the same worksheet by
importing it as shown below:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="go">%%cython</span>
<span class="go">from __main__ import testfunction</span>
</pre></div>
</div>
</li>
</ol>
<p>Refer to <a class="reference external" href="../reference/repl/sage/repl/ipython_extension.html#sage.repl.ipython_extension.SageMagics.cython" title="(in The Sage Command Line v10.6.1)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sage.repl.ipython_extension.SageMagics.cython()</span></code></a>.</p>
</li>
<li><p>Create an <code class="docutils literal notranslate"><span class="pre">.spyx</span></code> file and attach or load it
from the command line.</p></li>
<li><p>Create a <code class="docutils literal notranslate"><span class="pre">.pyx</span></code> file and add it to the Sage library.
Then run <code class="docutils literal notranslate"><span class="pre">sage</span> <span class="pre">-b</span></code> to rebuild Sage.</p></li>
</ol>
</section>
<section id="attaching-or-loading-spyx-files">
<h2>Attaching or loading .spyx files<a class="headerlink" href="#attaching-or-loading-spyx-files" title="Link to this heading">¶</a></h2>
<p>The easiest way to try out Cython without having to learn anything
about distutils, etc., is to create a file with the extension
<code class="docutils literal notranslate"><span class="pre">spyx</span></code>, which stands for “Sage Pyrex”:</p>
<ol class="arabic">
<li><p>Create a file <code class="docutils literal notranslate"><span class="pre">power2.spyx</span></code>.</p></li>
<li><p>Put the following in it:</p>
<div class="highlight-cython notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">is2pow</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">!=</span> <span class="mf">0</span> <span class="ow">and</span> <span class="n">n</span><span class="o">%</span><span class="mf">2</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">&gt;&gt;</span> <span class="mf">1</span>
    <span class="k">return</span> <span class="n">n</span> <span class="o">==</span> <span class="mf">1</span>
</pre></div>
</div>
</li>
<li><p>Start the Sage command line interpreter and load the <code class="docutils literal notranslate"><span class="pre">spyx</span></code> file
(this will fail if you do not have a C compiler installed).</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--0-input--1" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--1">Sage</label><div class="tab-content docutils container">
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage:</span> <span class="n">load</span><span class="p">(</span><span class="s2">&quot;power2.spyx&quot;</span><span class="p">)</span>
<span class="go">Compiling power2.spyx...</span>
<span class="gp">sage:</span> <span class="n">is2pow</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="go">False</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--0-input--2" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--2">Python</label><div class="tab-content docutils container">
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">sage.all</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt;</span> <span class="n">load</span><span class="p">(</span><span class="s2">&quot;power2.spyx&quot;</span><span class="p">)</span>
<span class="go">Compiling power2.spyx...</span>
<span class="gp">&gt;&gt;&gt;</span> <span class="n">is2pow</span><span class="p">(</span><span class="n">Integer</span><span class="p">(</span><span class="mi">12</span><span class="p">))</span>
<span class="go">False</span>
</pre></div>
</div>
</div>
</div>
</li>
</ol>
<p>Note that you can change <code class="docutils literal notranslate"><span class="pre">power2.spyx</span></code>, then load it again and it
will be recompiled on the fly. You can also attach <code class="docutils literal notranslate"><span class="pre">power2.spyx</span></code> so
it is reloaded whenever you make changes:</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--1-input--1" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--1">Sage</label><div class="tab-content docutils container">
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage:</span> <span class="n">attach</span><span class="p">(</span><span class="s2">&quot;power2.spyx&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--1-input--2" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--2">Python</label><div class="tab-content docutils container">
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">sage.all</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt;</span> <span class="n">attach</span><span class="p">(</span><span class="s2">&quot;power2.spyx&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Cython is used for its speed. Here is a timed test on a 2.6 GHz
Opteron:</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--2-input--1" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--1">Sage</label><div class="tab-content docutils container">
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage:</span> <span class="o">%</span><span class="k">time</span> [n for n in range(10^5) if is2pow(n)]
<span class="go">[1, 2, 4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048, 4096, 8192, 16384, 32768, 65536]</span>
<span class="go">CPU times: user 0.60 s, sys: 0.00 s, total: 0.60 s</span>
<span class="go">Wall time: 0.60 s</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--2-input--2" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--2">Python</label><div class="tab-content docutils container">
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">sage.all</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt;</span> <span class="o">%</span><span class="k">time</span> [n for n in range(Integer(10)**Integer(5)) if is2pow(n)]
<span class="go">[1, 2, 4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048, 4096, 8192, 16384, 32768, 65536]</span>
<span class="go">CPU times: user 0.60 s, sys: 0.00 s, total: 0.60 s</span>
<span class="go">Wall time: 0.60 s</span>
</pre></div>
</div>
</div>
</div>
<p>Now, the code in the file <code class="docutils literal notranslate"><span class="pre">power2.spyx</span></code> is valid Python, and if we
copy this to a file <code class="docutils literal notranslate"><span class="pre">powerslow.py</span></code> and load that, we get the
following:</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--3-input--1" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--1">Sage</label><div class="tab-content docutils container">
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage:</span> <span class="n">load</span><span class="p">(</span><span class="s2">&quot;powerslow.py&quot;</span><span class="p">)</span>
<span class="gp">sage:</span> <span class="o">%</span><span class="k">time</span> [n for n in range(10^5) if is2pow(n)]
<span class="go">[1, 2, 4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048, 4096, 8192, 16384, 32768, 65536]</span>
<span class="go">CPU times: user 1.01 s, sys: 0.04 s, total: 1.05 s</span>
<span class="go">Wall time: 1.05 s</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--3-input--2" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--2">Python</label><div class="tab-content docutils container">
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">sage.all</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt;</span> <span class="n">load</span><span class="p">(</span><span class="s2">&quot;powerslow.py&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span> <span class="o">%</span><span class="k">time</span> [n for n in range(Integer(10)**Integer(5)) if is2pow(n)]
<span class="go">[1, 2, 4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048, 4096, 8192, 16384, 32768, 65536]</span>
<span class="go">CPU times: user 1.01 s, sys: 0.04 s, total: 1.05 s</span>
<span class="go">Wall time: 1.05 s</span>
</pre></div>
</div>
</div>
</div>
<p>By the way, we could gain even a little more speed with the Cython
version with a type declaration, by changing <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">is2pow(n):</span></code> to
<code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">is2pow(unsigned</span> <span class="pre">int</span> <span class="pre">n):</span></code>.</p>
</section>
<section id="interrupt-and-signal-handling">
<span id="section-interrupt"></span><h2>Interrupt and signal handling<a class="headerlink" href="#interrupt-and-signal-handling" title="Link to this heading">¶</a></h2>
<p>When writing Cython code for Sage, special care must be taken to ensure
that the code can be interrupted with <code class="docutils literal notranslate"><span class="pre">CTRL-C</span></code>.</p>
<p>Sage uses the <a class="reference external" href="https://github.com/sagemath/cysignals">cysignals package</a>
for this, see the <a class="reference external" href="http://cysignals.readthedocs.org/">cysignals documentation</a>
for more information.</p>
</section>
<section id="unpickling-cython-code">
<h2>Unpickling Cython code<a class="headerlink" href="#unpickling-cython-code" title="Link to this heading">¶</a></h2>
<p>Pickling for Python classes and extension classes, such as Cython, is different.
This is discussed in the <a class="reference external" href="http://docs.python.org/library/pickle.html#pickle-protocol">Python pickling documentation</a>. For the unpickling of
extension classes you need to write a <code class="xref py py-meth docutils literal notranslate"><span class="pre">__reduce__()</span></code> method which typically
returns a tuple <code class="docutils literal notranslate"><span class="pre">(f,</span> <span class="pre">args,</span> <span class="pre">...)</span></code> such that <code class="docutils literal notranslate"><span class="pre">f(*args)</span></code> returns (a copy of) the
original object. As an example, the following code snippet is the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">__reduce__()</span></code> method from
<a class="reference external" href="../reference/rings_standard/sage/rings/integer.html#sage.rings.integer.Integer" title="(in Standard Commutative Rings v10.6.1)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sage.rings.integer.Integer</span></code></a>:</p>
<div class="highlight-cython notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This is used when pickling integers.</span>

<span class="sd">    EXAMPLES::</span>

<span class="sd">        sage: n = 5</span>
<span class="sd">        sage: t = n.__reduce__(); t</span>
<span class="sd">        (&lt;cyfunction make_integer at ...&gt;, (&#39;5&#39;,))</span>
<span class="sd">        sage: t[0](*t[1])</span>
<span class="sd">        5</span>
<span class="sd">        sage: loads(dumps(n)) == n</span>
<span class="sd">        True</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c"># This single line below took me HOURS to figure out.</span>
    <span class="c"># It is the *trick* needed to pickle Cython extension types.</span>
    <span class="c"># The trick is that you must put a pure Python function</span>
    <span class="c"># as the first argument, and that function must return</span>
    <span class="c"># the result of unpickling with the argument in the second</span>
    <span class="c"># tuple as input. All kinds of problems happen</span>
    <span class="c"># if we don&#39;t do this.</span>
    <span class="k">return</span> <span class="n">sage</span><span class="o">.</span><span class="n">rings</span><span class="o">.</span><span class="n">integer</span><span class="o">.</span><span class="n">make_integer</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="mf">32</span><span class="p">),)</span>
</pre></div>
</div>
</section>
<section id="deprecation">
<h2>Deprecation<a class="headerlink" href="#deprecation" title="Link to this heading">¶</a></h2>
<p>When making a <strong>backward-incompatible</strong> modification in Sage, the old code should
keep working and display a message indicating how it should be updated/written
in the future. We call this a <em>deprecation</em>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Deprecated code can only be removed one year after the first
stable release in which it appeared.</p>
</div>
<p>Each deprecation warning contains the number of the GitHub PR that defines
it. We use 666 in the example below.</p>
<div class="highlight-cython notranslate"><div class="highlight"><pre><span></span><span class="k">from</span> <span class="nn">sage.misc.superseded</span> <span class="k">import</span> <span class="n">deprecation_cython</span>
<span class="n">deprecation_cython</span><span class="p">(</span><span class="mf">666</span><span class="p">,</span> <span class="s">&quot;Do not use your computer to compute 1+1. Use your brain.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="coding_in_other.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Using External Libraries and Interfaces</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="coding_in_python.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Coding in Python for Sage</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2005--2025, The Sage Development Team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Coding in Cython</a><ul>
<li><a class="reference internal" href="#writing-cython-code-in-sage">Writing Cython code in Sage</a></li>
<li><a class="reference internal" href="#attaching-or-loading-spyx-files">Attaching or loading .spyx files</a></li>
<li><a class="reference internal" href="#interrupt-and-signal-handling">Interrupt and signal handling</a></li>
<li><a class="reference internal" href="#unpickling-cython-code">Unpickling Cython code</a></li>
<li><a class="reference internal" href="#deprecation">Deprecation</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=68afb76a"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=8e571dd6"></script>
    <script src="_static/tabs.js?v=3ee01567"></script>
    <script src="_static/thebelab-helper.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script src="_static/jupyter-sphinx-furo.js?v=1d35515b"></script>
    </body>
</html>